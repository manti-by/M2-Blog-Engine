# ##    ##  #######  ##  ##  ##    ##    ##  #######  ##     ##       ###    ########  ########
# ###   ## ##     ## ##  ##  ##     ##  ##  ##     ## ##     ##      ## ##   ##     ## ##
# ####  ## ##     ## ##  ##  ##      ####   ##     ## ##     ##     ##   ##  ##     ## ##
# ## ## ## ##     ## ##  ##  ##       ##    ##     ## ##     ##    ##     ## ########  ######
# ##  #### ##     ## ##  ##  ##       ##    ##     ## ##     ##    ######### ##   ##   ##
# ##   ### ##     ## ##  ##  ##       ##    ##     ## ##     ##    ##     ## ##    ##  ##
# ##    ##  #######   ###  ###        ##     #######   #######     ##     ## ##     ## ########
#
#                                ######## ######## ########  ##
#                                      ## ##       ##     ##
#                                      ## ##       ##     ## ##
#                                      ## ######## ##     ## ##
#                                      ## ##       ##     ## ##
#                                      ## ##       ##     ## ##
#                                ######   ######## ########  ##
#                                            ____
#                                         _.' :  `._
#                                     .-.'`.  ;   .'`.-.
#                            __      / : ___\ ;  /___ ; \      __
#                          ,'_ ""--.:__;".-.";: :".-.":__;.--"" _`,
#                          :' `.t""--.. '<@.`;_  ',@>` ..--""j.' `;
#                               `:-.._J '-.-'L__ `-- ' L_..-;'
#                                 "-.__ ;  .-"  "-.  : __.-"
#                                     L ' /.------.\ ' J
#                                      "-.   "--"   .-"
#                                     __.l"-:_JL_;-";.__
#                                  .-j/'.;  ;""""  / .'\"-.
#                                .' /:`. "-.:     .-" .';  `.
#                             .-"  / ;  "-. "-..-" .-"  :    "-.
#                          .+"-.  : :      "-.__.-"      ;-._   \
#                          ; \  `.; ;                    : : "+. ;
#                          :  ;   ; ;                    : ;  : \:
#                          ;  :   ; :                    ;:   ;  :
#                          : \  ;  :  ;                  : ;  /  ::
#                          ;  ; :   ; :                  ;   :   ;:
#                          :  :  ;  :  ;                : :  ;  : ;
#                          ;\    :   ; :                ; ;     ; ;
#                          : `."-;   :  ;              :  ;    /  ;
#                          ;    -:   ; :              ;  : .-"   :
#                          :\     \  :  ;            : \.-"      :
#                          ;`.    \  ; :            ;.'_..--  / ;
#                          :  "-.  "-:  ;          :/."      .'  :
#                           \         \ :          ;/  __        :
#                            \       .-`.\        /t-""  ":-+.   :
#                             `.  .-"    `l    __/ /`. :  ; ; \  ;
#                               \   .-" .-"-.-"  .' .'j \  /   ;/
#                                \ / .-"   /.     .'.' ;_:'    ;
#                                 :-""-.`./-.'     /    `.___.'
#                                       \ `t  ._  /
#                                        "-.t-._:'
#

DROP PROCEDURE IF EXISTS `GET_SESSION_STATS`;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `GET_SESSION_STATS`()
BEGIN
    SELECT CONCAT(`country`, ' [', `ip`, ']') AS `visitor`, `count`, `timestamp`
    FROM `stats_session`
    WHERE `timestamp` >= DATE(NOW()) - INTERVAL 1 WEEK
      AND `ip` <> '127.0.0.1'
    ORDER BY `timestamp` ASC;
END
;;
DELIMITER ;